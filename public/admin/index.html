<!-- admin/index.html -->
<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Admin</title>

    <!-- Si quieres usar un archivo de config en otra ruta, cambia el href -->
    <link href="/admin/config.yml" type="text/yaml" rel="cms-config-url" />
  </head>
  <body>
    <!-- arriba, antes del script de decap -->
<script>
  window.addEventListener('message', (event) => {
    // Ignorar mensajes sin data o de origen distinto (opcional)
    if (!event.data) return;

    // Si viene etiquetado como decap-auth lo procesamos
    if (event.data && event.data.type === 'decap-auth') {
      console.log('ðŸ”” admin RECEIVED decap-auth:', event.origin, event.data.payload);
      // Mostrar en debug box
      const el = document.getElementById('__decap_debug');
      if (el) el.innerText = JSON.stringify({ origin: event.origin, token: event.data.payload }, null, 2);

      // IMPORTANTE: forwardear el token a Decap si fuese necesario
      // Decap normalmente escucha directamente token object (access_token)
      // Si Decap no responde, podemos re-postMessage el token a la propia ventana
      // para que la librerÃ­a lo capture. Prueba esto solo si es necesario:
      try {
        // envÃ­a el payload tal cual (objeto con access_token) a la misma ventana para que Decap lo reciba
        window.postMessage(event.data.payload, window.location.origin);
        console.log('Forwarded token payload to window for Decap.');
      } catch (err) {
        console.error('Failed to forward token to window:', err);
      }

      return;
    }

    // Ignorar mensajes de extensiones (ej: metamask)
    // Opcional: loguear si quiere inspeccionar
    // console.log('Ignored postMessage', { origin: event.origin, data: event.data });
  });
</script>
<pre id="__decap_debug" style="position:fixed;right:8px;bottom:8px;z-index:9999;background:#fff;padding:8px;border:1px solid #ddd;max-width:400px;max-height:300px;overflow:auto;"></pre>

<script src="https://cdn.jsdelivr.net/npm/decap-cms@3.0.0/dist/decap-cms.js"></script>

  </body>
</html>
